<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.14.2/css/ol.css" type="text/css">
	
    <style>
        html,body
      {
        padding:0px;
        margin:0px;
        height:100%;
      }
      .map {
        height: 100%;
        width: 100%;
        overflow:hidden;
        }
    </style>
    <script src="http://openlayers.org/en/v3.14.2/build/ol.js" type="text/javascript"></script>
	<script src="https://code.jquery.com/jquery-2.2.1.min.js" type="text/javascript"></script>
    <title>OpenLayers 3 example</title>

	<script>
 var mousePositionControl = new ol.control.MousePosition({
      coordinateFormat: ol.coordinate.createStringXY(4),
      projection: 'EPSG:4326',
      // comment the following two lines to have the mouse position
      // be placed within the map.
      //className: 'custom-mouse-position',
      //target: document.getElementById('mouse-position'),
      undefinedHTML: '&nbsp;'
    });

  var api = 'ZPGEPCSM';
     function W3W2Coords(words)
     {
        data = {
          'key': api,
          'string': words
        };
        var api_response;
        $.post('http://api.what3words.com/w3w', data, function(response) {
          var coordinate = ol.proj.transform([response.position[1], response.position[0]], 'EPSG:4326', 'EPSG:3857')
          console.log(response);
          console.log(coordinate);
          zoomToCoord(coordinate);
        });
        return api_response;
      }
  function zoomToCoord(coord)
  {
    map.getView().setCenter([coord[0], coord[1]]);
    map.getView().setZoom(20);
  }

  function onW3W()
  {
    console.log(W3W2Coords($("#w3w").val()));
  }
</script>
  </head>

  <body>
    <div class="map">
      <div id="map" class="map"></div>
      <div id="panel" style="position:absolute;left:10px;bottom:30px;z-index:1000;background-color:White">
        <img src="what3words_logo.png" style="width:200px"><br/>
        <input id="w3w" type="textbox" style="width:200px" value="">
        <input type="button" value="Go" title="Go" onclick="onW3W()"/>
      </div>
    </div>
  <script type="text/javascript">
    var map = new ol.Map({
      controls: ol.control.defaults({
        attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
          collapsible: false
        })
      }).extend([mousePositionControl]),      
      target: 'map',
      layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      })
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([-3,54]),
        zoom: 4
      })
    });

    /**
 * Add a click handler to the map to render the popup.
 */
  map.on('click', function(evt) {
    var coordinate = evt.coordinate;
    //var hdms = ol.coordinate.toStringHDMS(ol.proj.transform(
    //    coordinate, 'EPSG:3857', 'EPSG:4326'));
    var coordXY = ol.proj.transform(coordinate,'EPSG:3857', 'EPSG:4326');

    var coordYX = [coordXY[1],coordXY[0]];
    var coordStringYX = ol.coordinate.toStringXY(coordYX,10);
    console.log(coordYX);
    

    console.log(coordStringYX);
    var data = {
      'key': api,
      'position': coordStringYX
    }
  
    
    $.post('http://api.what3words.com/position', data, function(response) {
       document.getElementById('w3w').value = response.words;
       
    });


  });
      //console.log(W3W2Coords('dynamic.snares.freshest'));
      //console.log(W3W2Coords('tides.ringers.refrain'));
      //onW3W();
  </script>

  </body>
</html>
